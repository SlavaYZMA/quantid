<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Квантовая идентичность · Влада Садик</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&display=swap">
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body,html{height:100%;overflow:hidden;background:#000;font-family:'IBM Plex Mono',monospace}
  canvas{position:fixed;inset:0;z-index:1;transition:filter 1.8s ease;filter:brightness(0.38) blur(4px)}
  canvas.clear{filter:none}
  .intro{position:fixed;inset:0;z-index:10;display:flex;align-items:center;justify-content:center;color:#fff;text-align:center;padding:40px;opacity:0;visibility:hidden;transition:opacity 1.6s ease}
  .intro.active{opacity:1;visibility:visible}
  .intro h1{font-size:38px;font-weight:600;letter-spacing:6px;margin-bottom:16px}
  .intro p{font-size:17px;line-height:1.8;max-width:720px;margin:28px auto}
  .intro input{background:transparent;border:none;border-bottom:1px solid #fff;color:#fff;font-size:19px;padding:12px 0;width:320px;max-width:90%;text-align:center;outline:none;margin:30px 0 40px}
  .intro button{background:none;border:none;color:#fff;font-size:18px;letter-spacing:3px;cursor:pointer;padding:10px 0;position:relative}
  .intro button::after{content:'';position:absolute;left:0;right:0;bottom:0;height:1px;background:#fff;transform:scaleX(0);transition:transform 0.4s ease}
  .intro button:hover::after{transform:scaleX(1)}
  .back{position:fixed;top:24px;left:24px;z-index:20;color:#fff;font-size:15px;background:rgba(0,0,0,0.6);padding:8px 16px;cursor:pointer;display:none;border-bottom:1px solid #fff}
  .back.active{display:block}
  .speed{position:fixed;top:80px;left:50%;transform:translateX(-50%);z-index:20;color:#fff;font-size:17px;background:rgba(0,0,0,0.7);padding:8px 24px;display:none}
  .speed.active{display:block}
  .desc{position:fixed;bottom:24px;left:24px;right:24px;z-index:20;color:#fff;font-size:16px;line-height:1.7;background:rgba(0,0,0,0.5);padding:20px;display:none;word-spacing:4px}
  .desc.active{display:block}
  .loading{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:30;color:#fff;font-size:22px;background:rgba(0,0,0,0.9);padding:35px 70px;border:1px solid #fff;display:none;line-height:1.6;text-align:center}
  .download-btn{position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:#fff;color:#000;padding:18px 40px;font-size:18px;letter-spacing:3px;cursor:pointer;z-index:30;border:2px solid #fff;border-radius:8px;box-shadow:0 15px 40px rgba(0,0,0,0.7);font-weight:600;display:none}
  .download-btn.active{display:block}
</style>
</head>
<body>

<canvas id="c"></canvas>
<div class="loading" id="loading">ИИ входит в тебя...<br>8–15 секунд</div>

<div class="intro active" id="welcome">
  <div>
    <h1>КВАНТОВАЯ ИДЕНТИЧНОСТЬ</h1>
    <div class="year">2025—2026 · Влада Садик</div>
    <p>Твоя личность — не список ролей. Это живая квантовая пена, где каждая мысль, страх, любовь и творчество — настоящий инстантон.</p>
    <button type="button" onclick="showUsername()">НАЧАТЬ</button>
  </div>
</div>

<div class="intro" id="username">
  <div>
    <h1>ВВЕДИ СВОЙ INSTAGRAM</h1>
    <p>Только публичный профиль · ничего не сохраняется</p>
    <input type="text" id="user" placeholder="@username" autocomplete="off">
    <button type="button" onclick="enter()">ЗАПУСТИТЬ</button>
  </div>
</div>

<div class="back" id="back">← назад</div>
<div class="speed" id="speed">скор ×1.00</div>
<div class="desc" id="desc">случайный вакуум</div>
<div class="download-btn" id="downloadBtn">СКАЧАТЬ КВАНТОВЫЙ ПАСПОРТ</div>

<script>
// === ТВОЙ РАБОЧИЙ СЕРВЕР ===
const ONTOLOGY_SERVER = "https://slavayzma--quantum-ontology-ontology.modal.run";

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth; canvas.height = innerHeight;
window.onresize = () => { canvas.width = innerWidth; canvas.height = innerHeight; };

const size = 96;
const field = new Float32Array(size*size*size);
let t = 0;
let speed = 1.0;
let clusters = [];

// Начальная пена (до загрузки реального профиля)
clusters = "ночной свет тень пульс эхо шёпот вспышка пустота".split(" ").map(name => ({name, weight: 0.8 + Math.random()*0.6}));
for (let i = 0; i < 60; i++) setTimeout(() => createCluster(), i*30);

function createCluster() {
  if (clusters.length === 0) return;
  const x0 = Math.random()*size, y0 = Math.random()*size, z0 = Math.random()*size;
  const rho = 5 + Math.random()*9;
  const r = weightedRandom(clusters.map(c => c.weight));
  const s = clusters[r].weight * (1.6 + Math.random()*0.8);
  const phase = Math.random()*Math.PI*2;

  for (let dx = -rho*2|0; dx < rho*2; dx++) 
  for (let dy = -rho*2|0; dy < rho*2; dy++) 
  for (let dz = -rho*2|0; dz < rho*2; dz++) {
    const x = Math.floor(x0+dx), y = Math.floor(y0+dy), z = Math.floor(z0+dz);
    if (x<0||x>=size||y<0||y>=size||z<0||z>=size) continue;
    const d = Math.hypot(dx,dy,dz);
    if (d < rho*1.8) field[z*size*size + y*size + x] += s * Math.exp(-d*d/(rho*rho)) * Math.cos(t*0.03 + phase);
  }
}

function weightedRandom(weights) {
  const sum = weights.reduce((a,b)=>a+b,0);
  let r = Math.random()*sum;
  for (let i=0;i<weights.length;i++) { 
    r -= weights[i]; 
    if (r <= 0) return i; 
  }
  return weights.length-1;
}

// === КРАСИВЫЙ ЖИВОЙ ТЕКСТ С ПРОЦЕНТАМИ ===
function updateDesc() {
  const descEl = document.getElementById('desc');
  if (!clusters || clusters.length <= 10) {
    descEl.textContent = "случайный вакуум";
  } else {
    const total = clusters.reduce((s, c) => s + c.weight, 0);
    const top = clusters.slice(0, 8);
    const lines = top.map(c => {
      const percent = (c.weight / total * 100).toFixed(1);
      return `${c.name} ${percent}%`;
    });
    descEl.textContent = lines.join(" · ") + (clusters.length > 8 ? " …" : "");
  }
  descEl.classList.add('active');
}

setInterval(() => {
  t += 0.018 * speed;
  const decay = Math.pow(0.996, speed);
  for (let i=0;i<field.length;i++) field[i] *= decay;
  if (Math.random() < 0.16 * speed) createCluster();

  updateDesc(); // ← каждый кадр — актуальный текст

  ctx.fillStyle = '#000008';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  const sx = canvas.width/size, sy = canvas.height/size;
  for (let y=0;y<size;y++) for (let x=0;x<size;x++) {
    let sum = 0;
    for (let z=0;z<size;z++) sum += field[z*size*size + y*size + x];
    const q = sum/size;
    if (Math.abs(q)>0.011) {
      const hue = q>0?188:298;
      const i = Math.min(Math.abs(q)*11,1);
      ctx.fillStyle = `hsla(${hue},100%,${58+i*37}%,${i})`;
      ctx.fillRect(x*sx,y*sy,sx+1,sy+1);
    }
  }
}, 16);

// === ЗАПУСК ОНТОЛОГИИ ===
async function enter() {
  const raw = document.getElementById('user')?.value.trim().replace(/^@/,'');
  if (!raw) return alert("Введи username");

  document.getElementById('loading').style.display = 'block';

  let result;
  try {
    const resp = await fetch(ONTOLOGY_SERVER, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({username: raw})
    });
    result = await resp.json();
  } catch(e) {
    result = {error: "сервер спит или профиль приватный"};
  }

  document.getElementById('loading').style.display = 'none';

  if (result.error || !result.clusters) {
    document.getElementById('desc').textContent = "приватный профиль · базовая онтология";
    document.getElementById('desc').classList.add('active');
    document.getElementById('downloadBtn').classList.remove('active');
    return;
  }

  // ← НАСТОЯЩИЕ КЛАСТЕРЫ ИЗ ТВОЕЙ ДУШИ
  clusters = result.clusters.sort((a,b) => b.weight - a.weight);
  updateDesc(); // ← сразу видно!

  // паспорт
  let txt = `КВАНТОВЫЙ ПАСПОРТ · @${raw}\n${new Date().toLocaleString('ru-RU')}\n\nОнтология: ${clusters.length} версий себя\n\n`;
  clusters.forEach((c,i) => txt += `${i+1}. ${c.name} (вес ${c.weight})\n`);
  const blob = new Blob([txt], {type: "text/plain;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  document.getElementById('downloadBtn').onclick = () => {
    const a = document.createElement('a'); a.href = url; a.download = `quantum-passport_${raw}_${new Date().toISOString().slice(0,10)}.txt`; a.click();
  };
  document.getElementById('downloadBtn').classList.add('active');

  document.title = `Квантовая идентичность · @${raw}`;
  document.getElementById('username').classList.remove('active');
  canvas.classList.add('clear');
  document.getElementById('back').classList.add('active');
  document.getElementById('speed').classList.add('active');
}

function showUsername() {
  document.getElementById('welcome').classList.remove('active');
  document.getElementById('username').classList.add('active');
  setTimeout(() => document.getElementById('user').focus(), 300);
}

document.getElementById('back').onclick = () => location.reload();

document.addEventListener('wheel', e => {
  speed = e.deltaY < 0 ? Math.min(speed*1.4, 100) : Math.max(speed/1.4, 0.01);
  document.getElementById('speed').textContent = `скор ×${speed.toFixed(2)}`;
});
</script>
</body>
</html>


